openapi: 3.1.0
info:
  title: Sandbox API
  description: A unified API for executing commands, reading files, writing files, and viewing logs in a sandboxed environment.
  version: 2.0.0
  x-openai:
    privacy_policy_url: https://bill-bishop.github.io/execution-sandbox/privacy-policy.txt
servers:
  - url: https://dropcode.org
    description: Public-facing sandbox API
paths:
  /api/execute:
    post:
      operationId: executeCommand
      summary: Execute a bash command (non-blocking wrapper).
      description: |
        Starts execution of a bash command in the sandbox environment.
        Runs inside a PTY for terminal-like behavior.

        This endpoint does not wait for full completion. Instead, it returns quickly
        (after a few seconds) with initial output and a `job_id`.

        Full output continues streaming via WebSocket at `/ws/workspace`,
        or can be retrieved incrementally using `/api/workspace/logs`.
      security:
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                command:
                  type: string
                pwd:
                  type: string
              required:
                - command
      responses:
        '200':
          description: Started execution.
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                  command:
                    type: string
                  returncode:
                    type: integer
                    nullable: true
                    description: May be null if process still running.
                  stdout:
                    type: string
                    description: Initial captured output (partial).
  /api/write:
    post:
      operationId: writeFile
      summary: Write content to a file using JSON input.
      description: Creates or overwrites a file in the sandbox directory with the specified filename and content provided in the request body.
      security:
        - apiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                filename:
                  type: string
                  description: The name of the file to write.
                content:
                  type: string
                  description: The content to write to the file.
              required:
                - filename
                - content
      responses:
        '200':
          description: Successfully wrote to the file.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Status of the write operation (e.g., "success").
        '400':
          description: Bad Request – Missing filename or content in the request body.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: The error message.
        '401':
          description: Unauthorized – Missing or invalid API key.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: Error message.
        '500':
          description: Internal Server Error – An error occurred while writing to the file.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    description: The error message.
  /api/workspace/logs:
    get:
      operationId: getWorkspaceLogs
      summary: Get a slice of the workspace log buffer.
      description: |
        Returns recent command and output events from the shared workspace log.
        Use this endpoint to fetch history, while `/ws/workspace` provides live streaming.
      parameters:
        - name: offset
          in: query
          required: false
          schema:
            type: integer
          description: Absolute or negative offset (e.g. -20 for last 20 entries).
        - name: limit
          in: query
          required: false
          schema:
            type: integer
          description: Max number of events to return (default 100).
      responses:
        '200':
          description: Workspace log slice.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    seq_id:
                      type: integer
                    type:
                      type: string
                      enum: [command, output]
                    command:
                      type: string
                    stream:
                      type: string
                    line:
                      type: string
  /api/read:
    get:
      operationId: readFile
      summary: Read the content of a file.
      parameters:
        - name: filename
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successfully read the file.
  /api/read-partial:
    get:
      operationId: readPartial
      summary: Read part of a file with offset and limit.
      description: Fetches a chunk of file content starting at the given offset.
      security:
        - apiKeyAuth: []
      parameters:
        - name: filename
          in: query
          required: true
          schema:
            type: string
        - name: offset
          in: query
          required: false
          schema:
            type: integer
        - name: limit
          in: query
          required: false
          schema:
            type: integer
      responses:
        '200':
          description: Successfully read partial content.
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: string
                  offset:
                    type: integer
                  nextOffset:
                    type: integer
                  eof:
                    type: boolean
components:
  securitySchemes:
    apiKeyAuth:
      type: apiKey
      in: header
      name: API-Key
  schemas: {}
